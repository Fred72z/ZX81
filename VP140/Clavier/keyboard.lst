CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 1

ADDR CODE  LINE SOURCE

           0001 
           0002 ; CC5X Version 3.4I, Copyright (c) B Knudsen Data
           0003 ; C compiler for the PICmicro family
           0004 ; ************   9. Apr 2022  18:53  *************
           0005 
           0006 	processor  16F876A
           0007 	radix  DEC
           0008 
2007 3F3A  0009 	__config 0x3F3A
           0010 
     0000  0011 INDF        EQU   0x00
     0001  0012 TMR0        EQU   0x01
     0004  0013 FSR         EQU   0x04
     0005  0014 PORTA       EQU   0x05
     0085  0015 TRISA       EQU   0x85
     0006  0016 PORTB       EQU   0x06
     0086  0017 TRISB       EQU   0x86
     0000  0018 Carry       EQU   0
     0002  0019 Zero_       EQU   2
     0005  0020 RP0         EQU   5
     0006  0021 RP1         EQU   6
     0007  0022 IRP         EQU   7
     0002  0023 T0IF        EQU   2
     0081  0024 OPTION_REG  EQU   0x81
     0007  0025 PORTC       EQU   0x07
     0087  0026 TRISC       EQU   0x87
     009F  0027 ADCON1      EQU   0x9F
     010C  0028 EEDATA      EQU   0x10C
     010D  0029 EEADR       EQU   0x10D
     010E  0030 EEDATH      EQU   0x10E
     010F  0031 EEADRH      EQU   0x10F
     0000  0032 RD          EQU   0
     0007  0033 EEPGD       EQU   7
     0004  0034 RESET       EQU   4
     0000  0035 KB_LATCH    EQU   0
     0001  0036 KB_DATA     EQU   1
     0002  0037 KB_CLK      EQU   2
     0005  0038 VOL_A       EQU   5
     0004  0039 VOL_B       EQU   4
     0043  0040 VOLUME      EQU   0x43
     0020  0041 i           EQU   0x20
     0021  0042 bcle        EQU   0x21
     0022  0043 a           EQU   0x22
     0023  0044 n           EQU   0x23
     0024  0045 i_2         EQU   0x24
     0025  0046 j           EQU   0x25
     0022  0047 i_3         EQU   0x22
     0023  0048 a_2         EQU   0x23
     0022  0049 i_4         EQU   0x22
     0023  0050 a_3         EQU   0x23
     0024  0051 b           EQU   0x24
     0025  0052 cp          EQU   0x25
     0022  0053 n_2         EQU   0x22
     0022  0054 i_5         EQU   0x22
     0023  0055 r           EQU   0x23
     0022  0056 i_6         EQU   0x22
     0023  0057 r_2         EQU   0x23
     0022  0058 i_7         EQU   0x22
     0023  0059 r_3         EQU   0x23
     0024  0060 s           EQU   0x24
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 2

ADDR CODE  LINE SOURCE

     0022  0061 i_8         EQU   0x22
     0023  0062 r_4         EQU   0x23
     0022  0063 i_9         EQU   0x22
     0026  0064 i_10        EQU   0x26
     0022  0065 i_11        EQU   0x22
     002A  0066 i_12        EQU   0x2A
     0022  0067 k           EQU   0x22
     0023  0068 b_2         EQU   0x23
     0024  0069 i_13        EQU   0x24
     0025  0070 j_2         EQU   0x25
     0026  0071 a_4         EQU   0x26
     0027  0072 n_3         EQU   0x27
     0028  0073 ad          EQU   0x28
     0026  0074 n_4         EQU   0x26
     0027  0075 d           EQU   0x27
     0028  0076 b_3         EQU   0x28
     002A  0077 ci          EQU   0x2A
     002A  0078 ci_2        EQU   0x2A
     002A  0079 ci_3        EQU   0x2A
           0080 
0000 2980  0081 	GOTO main
           0082 
           0083   ; FILE keyboard.c
           0084 			;// Interface clavier minitel vers ZX81
           0085 			;
           0086 			;//#include <p16F876.inc>
           0087 			;
           0088 			;#pragma config=0x3f3a
           0089 			;
           0090 			;#pragma bit RESET @ PORTA.4
           0091 			;#pragma bit KB_LATCH @ PORTC.0
           0092 			;#pragma bit KB_DATA @ PORTC.1
           0093 			;#pragma bit KB_CLK @ PORTC.2
           0094 			;#pragma bit VOL_A @ PORTC.5
           0095 			;#pragma bit VOL_B @ PORTC.4
           0096 			;
           0097 			;
           0098 			;// A8,A9,A10,A11,A12,A13,A14,A15 -- KBD4-KBD0
           0099 			;const uns8 decod0[64]={
           0100 			;// Espace
           0101 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
           0102 			;// Ctrl
           0103 			;0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x00,
           0104 			;// Sommaire
           0105 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0106 			;// N
           0107 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x08,
           0108 			;// '
           0109 			;0x01,0x00,0x00,0x00,0x00,0x01,0x00,0x00,
           0110 			;// H
           0111 			;0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,
           0112 			;// Y
           0113 			;0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,
           0114 			;// Fleche bas
           0115 			;0x01,0x00,0x00,0x00,0x10,0x00,0x00,0x00
           0116 			;};
           0117 			;
           0118 			;const uns8 decod1[64]={
           0119 			;// W
           0120 			;0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 3

ADDR CODE  LINE SOURCE

           0121 			;// Q
           0122 			;0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,
           0123 			;// A
           0124 			;0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
           0125 			;// V
           0126 			;0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0127 			;// ,
           0128 			;0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x02,
           0129 			;// F
           0130 			;0x00,0x08,0x00,0x00,0x00,0x00,0x00,0x00,
           0131 			;// R
           0132 			;0x00,0x00,0x08,0x00,0x00,0x00,0x00,0x00,
           0133 			;// Annul
           0134 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
           0135 			;};
           0136 			;
           0137 			;const uns8 decod2[64]={
           0138 			;// X
           0139 			;0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0140 			;// S
           0141 			;0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x00,
           0142 			;// Z
           0143 			;0x02,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0144 			;// C
           0145 			;0x08,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0146 			;// Esc
           0147 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
           0148 			;// D
           0149 			;0x00,0x04,0x00,0x00,0x00,0x00,0x00,0x00,
           0150 			;// E
           0151 			;0x00,0x00,0x04,0x00,0x00,0x00,0x00,0x00,
           0152 			;// Corr
           0153 			;0x01,0x00,0x00,0x00,0x01,0x00,0x00,0x00
           0154 			;};
           0155 			;
           0156 			;const uns8 decod3[64]={
           0157 			;// Conn/Fin
           0158 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0159 			;// Fct
           0160 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0161 			;// Guide
           0162 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0163 			;// B
           0164 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,
           0165 			;// .
           0166 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x02,
           0167 			;// G
           0168 			;0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,
           0169 			;// T
           0170 			;0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,
           0171 			;// Fleche haut
           0172 			;0x01,0x00,0x00,0x00,0x08,0x00,0x00,0x00
           0173 			;};
           0174 			;
           0175 			;const uns8 decod4[64]={
           0176 			;// 3
           0177 			;0x00,0x00,0x00,0x04,0x00,0x00,0x00,0x00,
           0178 			;// M
           0179 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,
           0180 			;// P
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 4

ADDR CODE  LINE SOURCE

           0181 			;0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,
           0182 			;// 2
           0183 			;0x00,0x00,0x00,0x02,0x00,0x00,0x00,0x00,
           0184 			;// Rep
           0185 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0186 			;// 1
           0187 			;0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
           0188 			;// ?
           0189 			;0x09,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0190 			;// Return
           0191 			;0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00
           0192 			;};
           0193 			;
           0194 			;const uns8 decod5[64]={
           0195 			;// 6
           0196 			;0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,
           0197 			;// L
           0198 			;0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,
           0199 			;// O
           0200 			;0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,
           0201 			;// 5
           0202 			;0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,
           0203 			;// Envoi
           0204 			;0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,
           0205 			;// 4
           0206 			;0x00,0x00,0x00,0x08,0x00,0x00,0x00,0x00,
           0207 			;// :
           0208 			;0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0209 			;// fleche droite
           0210 			;0x01,0x00,0x00,0x00,0x04,0x00,0x00,0x00
           0211 			;};
           0212 			;
           0213 			;const uns8 decod6[64]={
           0214 			;// 9
           0215 			;0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x00,
           0216 			;// K
           0217 			;0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x00,
           0218 			;// I
           0219 			;0x00,0x00,0x00,0x00,0x00,0x04,0x00,0x00,
           0220 			;// 8
           0221 			;0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,
           0222 			;// Retour
           0223 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0224 			;// 7
           0225 			;0x00,0x00,0x00,0x00,0x08,0x00,0x00,0x00,
           0226 			;// -
           0227 			;0x01,0x00,0x00,0x00,0x00,0x00,0x08,0x00,
           0228 			;// fleche gauche
           0229 			;0x01,0x00,0x00,0x10,0x00,0x00,0x00,0x00
           0230 			;};
           0231 			;
           0232 			;const uns8 decod7[64]={
           0233 			;// #
           0234 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0235 			;// J
           0236 			;0x00,0x00,0x00,0x00,0x00,0x00,0x08,0x00,
           0237 			;// U
           0238 			;0x00,0x00,0x00,0x00,0x00,0x08,0x00,0x00,
           0239 			;// 0
           0240 			;0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 5

ADDR CODE  LINE SOURCE

           0241 			;// Suite
           0242 			;0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0243 			;// *
           0244 			;0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x10,
           0245 			;// ;
           0246 			;0x05,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
           0247 			;// Shift
           0248 			;0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00
           0249 			;};
           0250 			;
           0251 			;const uns8 rep[56]={
           0252 			;// RAND
           0253 			;0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,
           0254 			;// (F)
           0255 			;0x01,0x00,0x00,0x00,0x00,0x00,0x01,0x00,
           0256 			;// USR
           0257 			;0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x00,
           0258 			;// 8
           0259 			;0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,
           0260 			;// 8
           0261 			;0x00,0x00,0x00,0x00,0x04,0x00,0x00,0x00,
           0262 			;// 0
           0263 			;0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,
           0264 			;// 0
           0265 			;0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00
           0266 			;};
           0267 			;
           0268 			;
           0269 			;uns8 MAT[8];
           0270 			;uns8 MAT1[8];
           0271 			;uns8 KB[8];
           0272 			;uns8 VOLUME;
           0273 			;
           0274 			;
           0275 			;void scan();
           0276 			;uns8 test_RESET();
           0277 			;uns8 test_VOLUME();
           0278 			;void tempo_1ms();
           0279 			;void tempo_10ms();
           0280 			;void tempo_50ms();
           0281 			;void tempo_100ms();
           0282 			;void conversion();
           0283 			;void trf();
           0284 			;void raz_KB();
           0285 			;void copy_MAT();
           0286 			;uns8 compare_MAT();
           0287 			;uns8 noKey();
           0288 			;void waitnoKey();
           0289 			;uns8 test_REP();
           0290 			;void send_REP();
           0291 			;
           0292 			;
           0293 			;void main()
           0294 			;{
           0295 _const1
0001 1283  0296 	BCF   0x03,RP0
0002 1303  0297 	BCF   0x03,RP1
0003 00AA  0298 	MOVWF ci
0004 3000  0299 	MOVLW 0
0005 1703  0300 	BSF   0x03,RP1
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 6

ADDR CODE  LINE SOURCE

0006 008F  0301 	MOVWF EEADRH
0007 1303  0302 	BCF   0x03,RP1
0008 0C2A  0303 	RRF   ci,W
0009 397F  0304 	ANDLW 127
000A 3E22  0305 	ADDLW 34
000B 1703  0306 	BSF   0x03,RP1
000C 008D  0307 	MOVWF EEADR
000D 1803  0308 	BTFSC 0x03,Carry
000E 0A8F  0309 	INCF  EEADRH,1
000F 1683  0310 	BSF   0x03,RP0
0010 1703  0311 	BSF   0x03,RP1
0011 178C  0312 	BSF   0x18C,EEPGD
0012 140C  0313 	BSF   0x18C,RD
0013 0000  0314 	NOP  
0014 0000  0315 	NOP  
0015 1283  0316 	BCF   0x03,RP0
0016 1303  0317 	BCF   0x03,RP1
0017 182A  0318 	BTFSC ci,0
0018 281D  0319 	GOTO  m001
0019 1703  0320 	BSF   0x03,RP1
001A 080C  0321 	MOVF  EEDATA,W
001B 397F  0322 	ANDLW 127
001C 0008  0323 	RETURN
001D 1283  0324 m001	BCF   0x03,RP0
001E 1703  0325 	BSF   0x03,RP1
001F 0D0C  0326 	RLF   EEDATA,W
0020 0D0E  0327 	RLF   EEDATH,W
0021 0008  0328 	RETURN
0022 0000  0329 	DW    0x0
0023 0000  0330 	DW    0x0
0024 0000  0331 	DW    0x0
0025 0080  0332 	DW    0x80
0026 0001  0333 	DW    0x1
0027 0000  0334 	DW    0x0
0028 0000  0335 	DW    0x0
0029 0001  0336 	DW    0x1
002A 0000  0337 	DW    0x0
002B 0000  0338 	DW    0x0
002C 0000  0339 	DW    0x0
002D 0000  0340 	DW    0x0
002E 0000  0341 	DW    0x0
002F 0000  0342 	DW    0x0
0030 0000  0343 	DW    0x0
0031 0400  0344 	DW    0x400
0032 0001  0345 	DW    0x1
0033 0000  0346 	DW    0x0
0034 0080  0347 	DW    0x80
0035 0000  0348 	DW    0x0
0036 0000  0349 	DW    0x0
0037 0000  0350 	DW    0x0
0038 0000  0351 	DW    0x0
0039 0010  0352 	DW    0x10
003A 0000  0353 	DW    0x0
003B 0000  0354 	DW    0x0
003C 0800  0355 	DW    0x800
003D 0000  0356 	DW    0x0
003E 0001  0357 	DW    0x1
003F 0000  0358 	DW    0x0
0040 0010  0359 	DW    0x10
0041 0000  0360 	DW    0x0
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 7

ADDR CODE  LINE SOURCE

0042 0000  0361 	DW    0x0
0043 0000  0362 	DW    0x0
0044 0000  0363 	DW    0x0
0045 0000  0364 	DW    0x0
0046 0000  0365 	DW    0x0
0047 0000  0366 	DW    0x0
0048 0000  0367 	DW    0x0
0049 0008  0368 	DW    0x8
004A 0000  0369 	DW    0x0
004B 0000  0370 	DW    0x0
004C 0400  0371 	DW    0x400
004D 0000  0372 	DW    0x0
004E 0000  0373 	DW    0x0
004F 0000  0374 	DW    0x0
0050 0001  0375 	DW    0x1
0051 0000  0376 	DW    0x0
0052 0000  0377 	DW    0x0
0053 0000  0378 	DW    0x0
0054 0000  0379 	DW    0x0
0055 0000  0380 	DW    0x0
0056 0001  0381 	DW    0x1
0057 0000  0382 	DW    0x0
0058 0000  0383 	DW    0x0
0059 0800  0384 	DW    0x800
005A 0005  0385 	DW    0x5
005B 0000  0386 	DW    0x0
005C 0000  0387 	DW    0x0
005D 0000  0388 	DW    0x0
005E 0001  0389 	DW    0x1
005F 0000  0390 	DW    0x0
0060 0000  0391 	DW    0x0
0061 0000  0392 	DW    0x0
0062 0000  0393 	DW    0x0
0063 0010  0394 	DW    0x10
0064 0000  0395 	DW    0x0
0065 0000  0396 	DW    0x0
0066 0001  0397 	DW    0x1
0067 0000  0398 	DW    0x0
0068 0000  0399 	DW    0x0
0069 0001  0400 	DW    0x1
006A 0000  0401 	DW    0x0
006B 0000  0402 	DW    0x0
006C 0000  0403 	DW    0x0
006D 0002  0404 	DW    0x2
006E 0000  0405 	DW    0x0
006F 0000  0406 	DW    0x0
0070 0004  0407 	DW    0x4
0071 0000  0408 	DW    0x0
0072 0000  0409 	DW    0x0
0073 0000  0410 	DW    0x0
0074 0004  0411 	DW    0x4
0075 0000  0412 	DW    0x0
0076 0000  0413 	DW    0x0
0077 0000  0414 	DW    0x0
0078 0001  0415 	DW    0x1
0079 0000  0416 	DW    0x0
007A 0000  0417 	DW    0x0
007B 0000  0418 	DW    0x0
007C 0001  0419 	DW    0x1
007D 0000  0420 	DW    0x0
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 8

ADDR CODE  LINE SOURCE

           0421 _const3
007E 1283  0422 	BCF   0x03,RP0
007F 1303  0423 	BCF   0x03,RP1
0080 00AA  0424 	MOVWF ci_2
0081 3000  0425 	MOVLW 0
0082 1703  0426 	BSF   0x03,RP1
0083 008F  0427 	MOVWF EEADRH
0084 1303  0428 	BCF   0x03,RP1
0085 0C2A  0429 	RRF   ci_2,W
0086 397F  0430 	ANDLW 127
0087 3E9F  0431 	ADDLW 159
0088 1703  0432 	BSF   0x03,RP1
0089 008D  0433 	MOVWF EEADR
008A 1803  0434 	BTFSC 0x03,Carry
008B 0A8F  0435 	INCF  EEADRH,1
008C 1683  0436 	BSF   0x03,RP0
008D 1703  0437 	BSF   0x03,RP1
008E 178C  0438 	BSF   0x18C,EEPGD
008F 140C  0439 	BSF   0x18C,RD
0090 0000  0440 	NOP  
0091 0000  0441 	NOP  
0092 1283  0442 	BCF   0x03,RP0
0093 1303  0443 	BCF   0x03,RP1
0094 182A  0444 	BTFSC ci_2,0
0095 289A  0445 	GOTO  m002
0096 1703  0446 	BSF   0x03,RP1
0097 080C  0447 	MOVF  EEDATA,W
0098 397F  0448 	ANDLW 127
0099 0008  0449 	RETURN
009A 1283  0450 m002	BCF   0x03,RP0
009B 1703  0451 	BSF   0x03,RP1
009C 0D0C  0452 	RLF   EEDATA,W
009D 0D0E  0453 	RLF   EEDATH,W
009E 0008  0454 	RETURN
009F 0000  0455 	DW    0x0
00A0 0002  0456 	DW    0x2
00A1 0000  0457 	DW    0x0
00A2 0000  0458 	DW    0x0
00A3 0000  0459 	DW    0x0
00A4 0001  0460 	DW    0x1
00A5 0000  0461 	DW    0x0
00A6 0000  0462 	DW    0x0
00A7 0080  0463 	DW    0x80
00A8 0000  0464 	DW    0x0
00A9 0000  0465 	DW    0x0
00AA 0000  0466 	DW    0x0
00AB 0010  0467 	DW    0x10
00AC 0000  0468 	DW    0x0
00AD 0000  0469 	DW    0x0
00AE 0000  0470 	DW    0x0
00AF 0001  0471 	DW    0x1
00B0 0000  0472 	DW    0x0
00B1 0000  0473 	DW    0x0
00B2 0100  0474 	DW    0x100
00B3 0400  0475 	DW    0x400
00B4 0000  0476 	DW    0x0
00B5 0000  0477 	DW    0x0
00B6 0000  0478 	DW    0x0
00B7 0000  0479 	DW    0x0
00B8 0008  0480 	DW    0x8
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 9

ADDR CODE  LINE SOURCE

00B9 0000  0481 	DW    0x0
00BA 0000  0482 	DW    0x0
00BB 0000  0483 	DW    0x0
00BC 0000  0484 	DW    0x0
00BD 0000  0485 	DW    0x0
00BE 0000  0486 	DW    0x0
00BF 0004  0487 	DW    0x4
00C0 0000  0488 	DW    0x0
00C1 0000  0489 	DW    0x0
00C2 0000  0490 	DW    0x0
00C3 0100  0491 	DW    0x100
00C4 0000  0492 	DW    0x0
00C5 0000  0493 	DW    0x0
00C6 0000  0494 	DW    0x0
00C7 0002  0495 	DW    0x2
00C8 0000  0496 	DW    0x0
00C9 0000  0497 	DW    0x0
00CA 0000  0498 	DW    0x0
00CB 0008  0499 	DW    0x8
00CC 0000  0500 	DW    0x0
00CD 0000  0501 	DW    0x0
00CE 0000  0502 	DW    0x0
00CF 0000  0503 	DW    0x0
00D0 0000  0504 	DW    0x0
00D1 0000  0505 	DW    0x0
00D2 0080  0506 	DW    0x80
00D3 0200  0507 	DW    0x200
00D4 0000  0508 	DW    0x0
00D5 0000  0509 	DW    0x0
00D6 0000  0510 	DW    0x0
00D7 0000  0511 	DW    0x0
00D8 0004  0512 	DW    0x4
00D9 0000  0513 	DW    0x0
00DA 0000  0514 	DW    0x0
00DB 0001  0515 	DW    0x1
00DC 0000  0516 	DW    0x0
00DD 0001  0517 	DW    0x1
00DE 0000  0518 	DW    0x0
00DF 0000  0519 	DW    0x0
00E0 0000  0520 	DW    0x0
00E1 0000  0521 	DW    0x0
00E2 0000  0522 	DW    0x0
00E3 0000  0523 	DW    0x0
00E4 0000  0524 	DW    0x0
00E5 0000  0525 	DW    0x0
00E6 0000  0526 	DW    0x0
00E7 0000  0527 	DW    0x0
00E8 0000  0528 	DW    0x0
00E9 0000  0529 	DW    0x0
00EA 0000  0530 	DW    0x0
00EB 0000  0531 	DW    0x0
00EC 0000  0532 	DW    0x0
00ED 0000  0533 	DW    0x0
00EE 0800  0534 	DW    0x800
00EF 0000  0535 	DW    0x0
00F0 0000  0536 	DW    0x0
00F1 0000  0537 	DW    0x0
00F2 0100  0538 	DW    0x100
00F3 0800  0539 	DW    0x800
00F4 0000  0540 	DW    0x0
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 10

ADDR CODE  LINE SOURCE

00F5 0000  0541 	DW    0x0
00F6 0000  0542 	DW    0x0
00F7 0000  0543 	DW    0x0
00F8 0010  0544 	DW    0x10
00F9 0000  0545 	DW    0x0
00FA 0000  0546 	DW    0x0
00FB 0001  0547 	DW    0x1
00FC 0000  0548 	DW    0x0
00FD 0008  0549 	DW    0x8
00FE 0000  0550 	DW    0x0
00FF 0000  0551 	DW    0x0
0100 0200  0552 	DW    0x200
0101 0000  0553 	DW    0x0
0102 0000  0554 	DW    0x0
0103 0000  0555 	DW    0x0
0104 0000  0556 	DW    0x0
0105 0000  0557 	DW    0x0
0106 0200  0558 	DW    0x200
0107 0000  0559 	DW    0x0
0108 0000  0560 	DW    0x0
0109 0080  0561 	DW    0x80
010A 0000  0562 	DW    0x0
010B 0000  0563 	DW    0x0
010C 0100  0564 	DW    0x100
010D 0000  0565 	DW    0x0
010E 0000  0566 	DW    0x0
010F 0000  0567 	DW    0x0
0110 0000  0568 	DW    0x0
0111 0000  0569 	DW    0x0
0112 0000  0570 	DW    0x0
0113 0000  0571 	DW    0x0
0114 0080  0572 	DW    0x80
0115 0000  0573 	DW    0x0
0116 0000  0574 	DW    0x0
0117 0009  0575 	DW    0x9
0118 0000  0576 	DW    0x0
0119 0000  0577 	DW    0x0
011A 0000  0578 	DW    0x0
011B 0000  0579 	DW    0x0
011C 0000  0580 	DW    0x0
011D 0000  0581 	DW    0x0
011E 0001  0582 	DW    0x1
           0583 _const7
011F 1283  0584 	BCF   0x03,RP0
0120 1303  0585 	BCF   0x03,RP1
0121 00AA  0586 	MOVWF ci_3
0122 3001  0587 	MOVLW 1
0123 1703  0588 	BSF   0x03,RP1
0124 008F  0589 	MOVWF EEADRH
0125 1303  0590 	BCF   0x03,RP1
0126 0C2A  0591 	RRF   ci_3,W
0127 397F  0592 	ANDLW 127
0128 3E40  0593 	ADDLW 64
0129 1703  0594 	BSF   0x03,RP1
012A 008D  0595 	MOVWF EEADR
012B 1803  0596 	BTFSC 0x03,Carry
012C 0A8F  0597 	INCF  EEADRH,1
012D 1683  0598 	BSF   0x03,RP0
012E 1703  0599 	BSF   0x03,RP1
012F 178C  0600 	BSF   0x18C,EEPGD
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 11

ADDR CODE  LINE SOURCE

0130 140C  0601 	BSF   0x18C,RD
0131 0000  0602 	NOP  
0132 0000  0603 	NOP  
0133 1283  0604 	BCF   0x03,RP0
0134 1303  0605 	BCF   0x03,RP1
0135 182A  0606 	BTFSC ci_3,0
0136 293B  0607 	GOTO  m003
0137 1703  0608 	BSF   0x03,RP1
0138 080C  0609 	MOVF  EEDATA,W
0139 397F  0610 	ANDLW 127
013A 0008  0611 	RETURN
013B 1283  0612 m003	BCF   0x03,RP0
013C 1703  0613 	BSF   0x03,RP1
013D 0D0C  0614 	RLF   EEDATA,W
013E 0D0E  0615 	RLF   EEDATH,W
013F 0008  0616 	RETURN
0140 0000  0617 	DW    0x0
0141 0000  0618 	DW    0x0
0142 0010  0619 	DW    0x10
0143 0000  0620 	DW    0x0
0144 0000  0621 	DW    0x0
0145 0000  0622 	DW    0x0
0146 0000  0623 	DW    0x0
0147 0002  0624 	DW    0x2
0148 0000  0625 	DW    0x0
0149 0000  0626 	DW    0x0
014A 0100  0627 	DW    0x100
014B 0000  0628 	DW    0x0
014C 0000  0629 	DW    0x0
014D 0800  0630 	DW    0x800
014E 0000  0631 	DW    0x0
014F 0000  0632 	DW    0x0
0150 0000  0633 	DW    0x0
0151 0000  0634 	DW    0x0
0152 0000  0635 	DW    0x0
0153 0001  0636 	DW    0x1
0154 0000  0637 	DW    0x0
0155 0400  0638 	DW    0x400
0156 0000  0639 	DW    0x0
0157 0000  0640 	DW    0x0
0158 0003  0641 	DW    0x3
0159 0000  0642 	DW    0x0
015A 0000  0643 	DW    0x0
015B 0000  0644 	DW    0x0
015C 0001  0645 	DW    0x1
015D 0000  0646 	DW    0x0
015E 0004  0647 	DW    0x4
015F 0000  0648 	DW    0x0
0160 0000  0649 	DW    0x0
0161 0000  0650 	DW    0x0
0162 0002  0651 	DW    0x2
0163 0000  0652 	DW    0x0
0164 0000  0653 	DW    0x0
0165 0000  0654 	DW    0x0
0166 0000  0655 	DW    0x0
0167 0004  0656 	DW    0x4
0168 0000  0657 	DW    0x0
0169 0000  0658 	DW    0x0
016A 0200  0659 	DW    0x200
016B 0000  0660 	DW    0x0
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 12

ADDR CODE  LINE SOURCE

016C 0000  0661 	DW    0x0
016D 0000  0662 	DW    0x0
016E 0004  0663 	DW    0x4
016F 0000  0664 	DW    0x0
0170 0000  0665 	DW    0x0
0171 0000  0666 	DW    0x0
0172 0000  0667 	DW    0x0
0173 0000  0668 	DW    0x0
0174 0000  0669 	DW    0x0
0175 0000  0670 	DW    0x0
0176 0008  0671 	DW    0x8
0177 0000  0672 	DW    0x0
0178 0001  0673 	DW    0x1
0179 0000  0674 	DW    0x0
017A 0000  0675 	DW    0x0
017B 0008  0676 	DW    0x8
017C 0001  0677 	DW    0x1
017D 0800  0678 	DW    0x800
017E 0000  0679 	DW    0x0
017F 0000  0680 	DW    0x0
           0681 main
           0682 			;	uns8 i,bcle;
           0683 			;	TRISA=0x00;
0180 1683  0684 	BSF   0x03,RP0
0181 1303  0685 	BCF   0x03,RP1
0182 0185  0686 	CLRF  TRISA
           0687 			;	TRISB=0xFF;
0183 30FF  0688 	MOVLW 255
0184 0086  0689 	MOVWF TRISB
           0690 			;	TRISC=0x00;
0185 0187  0691 	CLRF  TRISC
           0692 			;	ADCON1=0;
0186 019F  0693 	CLRF  ADCON1
           0694 			;	OPTION=0x02;		// pullups activés sur le portB
0187 3002  0695 	MOVLW 2
0188 0081  0696 	MOVWF OPTION_REG
           0697 			;	
           0698 			;	PORTC=0;
0189 1283  0699 	BCF   0x03,RP0
018A 0187  0700 	CLRF  PORTC
           0701 			;	PORTA=0x10;
018B 3010  0702 	MOVLW 16
018C 0085  0703 	MOVWF PORTA
           0704 			;
           0705 			;	VOLUME=1;
018D 3001  0706 	MOVLW 1
018E 00C3  0707 	MOVWF VOLUME
           0708 			;	
           0709 			;	for (i=0;i<8;i++)
018F 01A0  0710 	CLRF  i
0190 3008  0711 m004	MOVLW 8
0191 1283  0712 	BCF   0x03,RP0
0192 1303  0713 	BCF   0x03,RP1
0193 0220  0714 	SUBWF i,W
0194 1803  0715 	BTFSC 0x03,Carry
0195 29A2  0716 	GOTO  m005
           0717 			;			{
           0718 			;				MAT[i]=0;
0196 302B  0719 	MOVLW 43
0197 0720  0720 	ADDWF i,W
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 13

ADDR CODE  LINE SOURCE

0198 0084  0721 	MOVWF FSR
0199 1383  0722 	BCF   0x03,IRP
019A 0180  0723 	CLRF  INDF
           0724 			;				KB[i]=0;
019B 303B  0725 	MOVLW 59
019C 0720  0726 	ADDWF i,W
019D 0084  0727 	MOVWF FSR
019E 1383  0728 	BCF   0x03,IRP
019F 0180  0729 	CLRF  INDF
           0730 			;			}
01A0 0AA0  0731 	INCF  i,1
01A1 2990  0732 	GOTO  m004
           0733 			;	bcle=0;
01A2 1283  0734 m005	BCF   0x03,RP0
01A3 1303  0735 	BCF   0x03,RP1
01A4 01A1  0736 	CLRF  bcle
           0737 			;	copy_MAT();
01A5 2230  0738 	CALL  copy_MAT
           0739 			;
           0740 			;while (1)
           0741 			;{
           0742 			;
           0743 			; if (bcle==0) copy_MAT();
01A6 1283  0744 m006	BCF   0x03,RP0
01A7 1303  0745 	BCF   0x03,RP1
01A8 08A1  0746 	MOVF  bcle,1
01A9 1903  0747 	BTFSC 0x03,Zero_
01AA 2230  0748 	CALL  copy_MAT
           0749 			; scan();
01AB 2275  0750 	CALL  scan
           0751 			;
           0752 			; if ((compare_MAT()==1) && (bcle<4)) bcle++;
01AC 2248  0753 	CALL  compare_MAT
01AD 3A01  0754 	XORLW 1
01AE 1D03  0755 	BTFSS 0x03,Zero_
01AF 29B6  0756 	GOTO  m007
01B0 3004  0757 	MOVLW 4
01B1 1283  0758 	BCF   0x03,RP0
01B2 1303  0759 	BCF   0x03,RP1
01B3 0221  0760 	SUBWF bcle,W
01B4 1C03  0761 	BTFSS 0x03,Carry
01B5 0AA1  0762 	INCF  bcle,1
           0763 			; if (compare_MAT()==0) bcle=0;
01B6 2248  0764 m007	CALL  compare_MAT
01B7 3A00  0765 	XORLW 0
01B8 1D03  0766 	BTFSS 0x03,Zero_
01B9 29BD  0767 	GOTO  m008
01BA 1283  0768 	BCF   0x03,RP0
01BB 1303  0769 	BCF   0x03,RP1
01BC 01A1  0770 	CLRF  bcle
           0771 			;
           0772 			;
           0773 			; if (test_RESET()==1)
01BD 22AD  0774 m008	CALL  test_RESET
01BE 3A01  0775 	XORLW 1
01BF 1D03  0776 	BTFSS 0x03,Zero_
01C0 29C9  0777 	GOTO  m009
           0778 			;			{
           0779 			;			 	RESET=0;
01C1 1283  0780 	BCF   0x03,RP0
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 14

ADDR CODE  LINE SOURCE

01C2 1303  0781 	BCF   0x03,RP1
01C3 1205  0782 	BCF   0x05,RESET
           0783 			;				tempo_100ms();
01C4 238B  0784 	CALL  tempo_100ms
           0785 			;			 	RESET=1;
01C5 1283  0786 	BCF   0x03,RP0
01C6 1303  0787 	BCF   0x03,RP1
01C7 1605  0788 	BSF   0x05,RESET
           0789 			;				waitnoKey();
01C8 22A5  0790 	CALL  waitnoKey
           0791 			;			}
           0792 			; if ((test_VOLUME()==1) && (VOLUME<3))
01C9 22D9  0793 m009	CALL  test_VOLUME
01CA 3A01  0794 	XORLW 1
01CB 1D03  0795 	BTFSS 0x03,Zero_
01CC 29D5  0796 	GOTO  m010
01CD 3003  0797 	MOVLW 3
01CE 1283  0798 	BCF   0x03,RP0
01CF 1303  0799 	BCF   0x03,RP1
01D0 0243  0800 	SUBWF VOLUME,W
01D1 1803  0801 	BTFSC 0x03,Carry
01D2 29D5  0802 	GOTO  m010
           0803 			;			{
           0804 			;				 VOLUME++;
01D3 0AC3  0805 	INCF  VOLUME,1
           0806 			;				 waitnoKey();
01D4 22A5  0807 	CALL  waitnoKey
           0808 			;			}
           0809 			; if ((test_VOLUME()==2) && (VOLUME>0))
01D5 22D9  0810 m010	CALL  test_VOLUME
01D6 3A02  0811 	XORLW 2
01D7 1D03  0812 	BTFSS 0x03,Zero_
01D8 29E0  0813 	GOTO  m011
01D9 1283  0814 	BCF   0x03,RP0
01DA 1303  0815 	BCF   0x03,RP1
01DB 08C3  0816 	MOVF  VOLUME,1
01DC 1903  0817 	BTFSC 0x03,Zero_
01DD 29E0  0818 	GOTO  m011
           0819 			;			{
           0820 			;				 VOLUME--;
01DE 03C3  0821 	DECF  VOLUME,1
           0822 			;				 waitnoKey();
01DF 22A5  0823 	CALL  waitnoKey
           0824 			;			}
           0825 			;
           0826 			; if (test_REP()==1)
01E0 233A  0827 m011	CALL  test_REP
01E1 3A01  0828 	XORLW 1
01E2 1903  0829 	BTFSC 0x03,Zero_
           0830 			;			 	 send_REP();
01E3 2202  0831 	CALL  send_REP
           0832 			;
           0833 			;
           0834 			; conversion();
01E4 23AB  0835 	CALL  conversion
           0836 			;
           0837 			; if (bcle>3) raz_KB();
01E5 3004  0838 	MOVLW 4
01E6 1283  0839 	BCF   0x03,RP0
01E7 1303  0840 	BCF   0x03,RP1
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 15

ADDR CODE  LINE SOURCE

01E8 0221  0841 	SUBWF bcle,W
01E9 1803  0842 	BTFSC 0x03,Carry
01EA 239A  0843 	CALL  raz_KB
           0844 			; trf();
01EB 2447  0845 	CALL  trf
           0846 			; VOL_A=VOLUME.0;
01EC 1283  0847 	BCF   0x03,RP0
01ED 1303  0848 	BCF   0x03,RP1
01EE 1C43  0849 	BTFSS VOLUME,0
01EF 1287  0850 	BCF   0x07,VOL_A
01F0 1843  0851 	BTFSC VOLUME,0
01F1 1687  0852 	BSF   0x07,VOL_A
           0853 			; VOL_B=VOLUME.1;
01F2 1CC3  0854 	BTFSS VOLUME,1
01F3 1207  0855 	BCF   0x07,VOL_B
01F4 18C3  0856 	BTFSC VOLUME,1
01F5 1607  0857 	BSF   0x07,VOL_B
           0858 			; tempo_10ms();
01F6 236D  0859 	CALL  tempo_10ms
           0860 			; if (bcle>3) 
01F7 3004  0861 	MOVLW 4
01F8 1283  0862 	BCF   0x03,RP0
01F9 1303  0863 	BCF   0x03,RP1
01FA 0221  0864 	SUBWF bcle,W
01FB 1C03  0865 	BTFSS 0x03,Carry
01FC 29A6  0866 	GOTO  m006
           0867 			;				{
           0868 			;					tempo_100ms();
01FD 238B  0869 	CALL  tempo_100ms
           0870 			;					bcle=0;
01FE 1283  0871 	BCF   0x03,RP0
01FF 1303  0872 	BCF   0x03,RP1
0200 01A1  0873 	CLRF  bcle
           0874 			;				}
           0875 			; }
0201 29A6  0876 	GOTO  m006
           0877 			;}
           0878 			;
           0879 			;
           0880 			;void send_REP()
           0881 			;{
           0882 send_REP
           0883 			;   uns8 a,n,i,j;
           0884 			;	n=0;
0202 1283  0885 	BCF   0x03,RP0
0203 1303  0886 	BCF   0x03,RP1
0204 01A3  0887 	CLRF  n
           0888 			;	for (i=0;i<7;i++)
0205 01A4  0889 	CLRF  i_2
0206 3007  0890 m012	MOVLW 7
0207 1283  0891 	BCF   0x03,RP0
0208 1303  0892 	BCF   0x03,RP1
0209 0224  0893 	SUBWF i_2,W
020A 1803  0894 	BTFSC 0x03,Carry
020B 2A2D  0895 	GOTO  m015
           0896 			;		{
           0897 			;			raz_KB();
020C 239A  0898 	CALL  raz_KB
           0899 			;			trf();
020D 2447  0900 	CALL  trf
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 16

ADDR CODE  LINE SOURCE

           0901 			;			tempo_50ms();
020E 237C  0902 	CALL  tempo_50ms
           0903 			;			for (j=0;j<8;j++)
020F 1283  0904 	BCF   0x03,RP0
0210 1303  0905 	BCF   0x03,RP1
0211 01A5  0906 	CLRF  j
0212 3008  0907 m013	MOVLW 8
0213 1283  0908 	BCF   0x03,RP0
0214 1303  0909 	BCF   0x03,RP1
0215 0225  0910 	SUBWF j,W
0216 1803  0911 	BTFSC 0x03,Carry
0217 2A27  0912 	GOTO  m014
           0913 			;					{
           0914 			;						a=rep[n];
0218 3080  0915 	MOVLW 128
0219 0723  0916 	ADDWF n,W
021A 2001  0917 	CALL  _const1
021B 1283  0918 	BCF   0x03,RP0
021C 1303  0919 	BCF   0x03,RP1
021D 00A2  0920 	MOVWF a
           0921 			;						KB[j]=a;
021E 303B  0922 	MOVLW 59
021F 0725  0923 	ADDWF j,W
0220 0084  0924 	MOVWF FSR
0221 1383  0925 	BCF   0x03,IRP
0222 0822  0926 	MOVF  a,W
0223 0080  0927 	MOVWF INDF
           0928 			;						n++;
0224 0AA3  0929 	INCF  n,1
           0930 			;					}
0225 0AA5  0931 	INCF  j,1
0226 2A12  0932 	GOTO  m013
           0933 			;			trf();
0227 2447  0934 m014	CALL  trf
           0935 			;			tempo_50ms();
0228 237C  0936 	CALL  tempo_50ms
           0937 			;		}
0229 1283  0938 	BCF   0x03,RP0
022A 1303  0939 	BCF   0x03,RP1
022B 0AA4  0940 	INCF  i_2,1
022C 2A06  0941 	GOTO  m012
           0942 			;			raz_KB();
022D 239A  0943 m015	CALL  raz_KB
           0944 			;			trf();
022E 2447  0945 	CALL  trf
           0946 			;			tempo_50ms();
022F 2B7C  0947 	GOTO  tempo_50ms
           0948 			;}
           0949 			;
           0950 			;void copy_MAT()
           0951 			;{
           0952 copy_MAT
           0953 			; uns8 i,a;
           0954 			; for (i=0;i<8;i++)
0230 1283  0955 	BCF   0x03,RP0
0231 1303  0956 	BCF   0x03,RP1
0232 01A2  0957 	CLRF  i_3
0233 3008  0958 m016	MOVLW 8
0234 1283  0959 	BCF   0x03,RP0
0235 1303  0960 	BCF   0x03,RP1
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 17

ADDR CODE  LINE SOURCE

0236 0222  0961 	SUBWF i_3,W
0237 1803  0962 	BTFSC 0x03,Carry
0238 2A47  0963 	GOTO  m017
           0964 			;		{
           0965 			;			a=MAT[i];
0239 302B  0966 	MOVLW 43
023A 0722  0967 	ADDWF i_3,W
023B 0084  0968 	MOVWF FSR
023C 1383  0969 	BCF   0x03,IRP
023D 0800  0970 	MOVF  INDF,W
023E 00A3  0971 	MOVWF a_2
           0972 			;			MAT1[i]=a;
023F 3033  0973 	MOVLW 51
0240 0722  0974 	ADDWF i_3,W
0241 0084  0975 	MOVWF FSR
0242 1383  0976 	BCF   0x03,IRP
0243 0823  0977 	MOVF  a_2,W
0244 0080  0978 	MOVWF INDF
           0979 			;		}
0245 0AA2  0980 	INCF  i_3,1
0246 2A33  0981 	GOTO  m016
           0982 			;}
0247 0008  0983 m017	RETURN
           0984 			;
           0985 			;uns8 compare_MAT()
           0986 			;{
           0987 compare_MAT
           0988 			; uns8 i,a,b,cp;
           0989 			; cp=1;
0248 3001  0990 	MOVLW 1
0249 1283  0991 	BCF   0x03,RP0
024A 1303  0992 	BCF   0x03,RP1
024B 00A5  0993 	MOVWF cp
           0994 			; b=1;
024C 3001  0995 	MOVLW 1
024D 00A4  0996 	MOVWF b
           0997 			; for (i=0;i<8;i++)
024E 01A2  0998 	CLRF  i_4
024F 3008  0999 m018	MOVLW 8
0250 1283  1000 	BCF   0x03,RP0
0251 1303  1001 	BCF   0x03,RP1
0252 0222  1002 	SUBWF i_4,W
0253 1803  1003 	BTFSC 0x03,Carry
0254 2A6C  1004 	GOTO  m019
           1005 			;	{
           1006 			;		a=MAT1[i];
0255 3033  1007 	MOVLW 51
0256 0722  1008 	ADDWF i_4,W
0257 0084  1009 	MOVWF FSR
0258 1383  1010 	BCF   0x03,IRP
0259 0800  1011 	MOVF  INDF,W
025A 00A3  1012 	MOVWF a_3
           1013 			;		if (a!=MAT[i]) cp=0;
025B 302B  1014 	MOVLW 43
025C 0722  1015 	ADDWF i_4,W
025D 0084  1016 	MOVWF FSR
025E 1383  1017 	BCF   0x03,IRP
025F 0823  1018 	MOVF  a_3,W
0260 0600  1019 	XORWF INDF,W
0261 1D03  1020 	BTFSS 0x03,Zero_
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 18

ADDR CODE  LINE SOURCE

0262 01A5  1021 	CLRF  cp
           1022 			;		if (a!=0) b=0;
0263 1283  1023 	BCF   0x03,RP0
0264 1303  1024 	BCF   0x03,RP1
0265 08A3  1025 	MOVF  a_3,1
0266 1D03  1026 	BTFSS 0x03,Zero_
0267 01A4  1027 	CLRF  b
           1028 			;
           1029 			;	}
0268 1283  1030 	BCF   0x03,RP0
0269 1303  1031 	BCF   0x03,RP1
026A 0AA2  1032 	INCF  i_4,1
026B 2A4F  1033 	GOTO  m018
           1034 			; if (b==1) cp=0;		// si MAT=0 alors differente
026C 1283  1035 m019	BCF   0x03,RP0
026D 1303  1036 	BCF   0x03,RP1
026E 0324  1037 	DECF  b,W
026F 1903  1038 	BTFSC 0x03,Zero_
0270 01A5  1039 	CLRF  cp
           1040 			; return cp;
0271 1283  1041 	BCF   0x03,RP0
0272 1303  1042 	BCF   0x03,RP1
0273 0825  1043 	MOVF  cp,W
0274 0008  1044 	RETURN
           1045 			;}
           1046 			;
           1047 			;
           1048 			;
           1049 			;
           1050 			;// scanne la matrice du clavier et retourne les 8 valeurs dans le tableau MAT
           1051 			;void scan()
           1052 			;{
           1053 scan
           1054 			;	uns8 n;
           1055 			;
           1056 			;	for (n=0;n<8;n++)
0275 1283  1057 	BCF   0x03,RP0
0276 1303  1058 	BCF   0x03,RP1
0277 01A2  1059 	CLRF  n_2
0278 3008  1060 m020	MOVLW 8
0279 1283  1061 	BCF   0x03,RP0
027A 1303  1062 	BCF   0x03,RP1
027B 0222  1063 	SUBWF n_2,W
027C 1803  1064 	BTFSC 0x03,Carry
027D 2A8A  1065 	GOTO  m021
           1066 			;		{
           1067 			;			PORTA=0x10 | n;
027E 3010  1068 	MOVLW 16
027F 0422  1069 	IORWF n_2,W
0280 0085  1070 	MOVWF PORTA
           1071 			;			nop();
0281 0000  1072 	NOP  
           1073 			;			MAT[n]=255-PORTB;
0282 302B  1074 	MOVLW 43
0283 0722  1075 	ADDWF n_2,W
0284 0084  1076 	MOVWF FSR
0285 1383  1077 	BCF   0x03,IRP
0286 0906  1078 	COMF  PORTB,W
0287 0080  1079 	MOVWF INDF
           1080 			;		}
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 19

ADDR CODE  LINE SOURCE

0288 0AA2  1081 	INCF  n_2,1
0289 2A78  1082 	GOTO  m020
           1083 			;}
028A 0008  1084 m021	RETURN
           1085 			;
           1086 			;uns8 noKey()
           1087 			;{
           1088 noKey
           1089 			;	uns8 i,r;
           1090 			;	r=1;
028B 3001  1091 	MOVLW 1
028C 1283  1092 	BCF   0x03,RP0
028D 1303  1093 	BCF   0x03,RP1
028E 00A3  1094 	MOVWF r
           1095 			;	for (i=0;i<8;i++)
028F 01A2  1096 	CLRF  i_5
0290 3008  1097 m022	MOVLW 8
0291 1283  1098 	BCF   0x03,RP0
0292 1303  1099 	BCF   0x03,RP1
0293 0222  1100 	SUBWF i_5,W
0294 1803  1101 	BTFSC 0x03,Carry
0295 2AA1  1102 	GOTO  m023
           1103 			;			if (MAT[i]!=0) r=0;
0296 302B  1104 	MOVLW 43
0297 0722  1105 	ADDWF i_5,W
0298 0084  1106 	MOVWF FSR
0299 1383  1107 	BCF   0x03,IRP
029A 0800  1108 	MOVF  INDF,W
029B 1D03  1109 	BTFSS 0x03,Zero_
029C 01A3  1110 	CLRF  r
           1111 			;
           1112 			;	return r;
029D 1283  1113 	BCF   0x03,RP0
029E 1303  1114 	BCF   0x03,RP1
029F 0AA2  1115 	INCF  i_5,1
02A0 2A90  1116 	GOTO  m022
02A1 1283  1117 m023	BCF   0x03,RP0
02A2 1303  1118 	BCF   0x03,RP1
02A3 0823  1119 	MOVF  r,W
02A4 0008  1120 	RETURN
           1121 			;}
           1122 			;
           1123 			;void waitnoKey()
           1124 			;{
           1125 waitnoKey
           1126 			;	while (noKey()!=1)
02A5 228B  1127 m024	CALL  noKey
02A6 3A01  1128 	XORLW 1
02A7 1903  1129 	BTFSC 0x03,Zero_
02A8 2AAC  1130 	GOTO  m025
           1131 			;		{
           1132 			;				scan();
02A9 2275  1133 	CALL  scan
           1134 			;				tempo_10ms();
02AA 236D  1135 	CALL  tempo_10ms
           1136 			;		}
02AB 2AA5  1137 	GOTO  m024
           1138 			;}
02AC 0008  1139 m025	RETURN
           1140 			;
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 20

ADDR CODE  LINE SOURCE

           1141 			;
           1142 			;uns8 test_RESET()	// teste si les touches Fnct+Fin sont appuyées
           1143 			;{
           1144 test_RESET
           1145 			;	uns8 i,r;
           1146 			;	r=1;
02AD 3001  1147 	MOVLW 1
02AE 1283  1148 	BCF   0x03,RP0
02AF 1303  1149 	BCF   0x03,RP1
02B0 00A3  1150 	MOVWF r_2
           1151 			;	for (i=0;i<8;i++)
02B1 01A2  1152 	CLRF  i_6
02B2 3008  1153 m026	MOVLW 8
02B3 1283  1154 	BCF   0x03,RP0
02B4 1303  1155 	BCF   0x03,RP1
02B5 0222  1156 	SUBWF i_6,W
02B6 1803  1157 	BTFSC 0x03,Carry
02B7 2AD5  1158 	GOTO  m029
           1159 			;	switch(i)
02B8 0822  1160 	MOVF  i_6,W
02B9 3A03  1161 	XORLW 3
02BA 1D03  1162 	BTFSS 0x03,Zero_
02BB 2AC8  1163 	GOTO  m027
           1164 			;		{
           1165 			;			case 3  : if (MAT[i]!=0xC0) r=0; break;
02BC 302B  1166 	MOVLW 43
02BD 1283  1167 	BCF   0x03,RP0
02BE 1303  1168 	BCF   0x03,RP1
02BF 0722  1169 	ADDWF i_6,W
02C0 0084  1170 	MOVWF FSR
02C1 1383  1171 	BCF   0x03,IRP
02C2 0800  1172 	MOVF  INDF,W
02C3 3AC0  1173 	XORLW 192
02C4 1903  1174 	BTFSC 0x03,Zero_
02C5 2AD1  1175 	GOTO  m028
02C6 01A3  1176 	CLRF  r_2
02C7 2AD1  1177 	GOTO  m028
           1178 			;			default : if (MAT[i]!=0x00) r=0;
02C8 302B  1179 m027	MOVLW 43
02C9 1283  1180 	BCF   0x03,RP0
02CA 1303  1181 	BCF   0x03,RP1
02CB 0722  1182 	ADDWF i_6,W
02CC 0084  1183 	MOVWF FSR
02CD 1383  1184 	BCF   0x03,IRP
02CE 0800  1185 	MOVF  INDF,W
02CF 1D03  1186 	BTFSS 0x03,Zero_
02D0 01A3  1187 	CLRF  r_2
           1188 			;		}
02D1 1283  1189 m028	BCF   0x03,RP0
02D2 1303  1190 	BCF   0x03,RP1
02D3 0AA2  1191 	INCF  i_6,1
02D4 2AB2  1192 	GOTO  m026
           1193 			;	return r;
02D5 1283  1194 m029	BCF   0x03,RP0
02D6 1303  1195 	BCF   0x03,RP1
02D7 0823  1196 	MOVF  r_2,W
02D8 0008  1197 	RETURN
           1198 			;}
           1199 			;
           1200 			;
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 21

ADDR CODE  LINE SOURCE

           1201 			;uns8 test_VOLUME()	// teste si les touches Sommaire ou Guide sont appuyées
           1202 			;{
           1203 test_VOLUME
           1204 			;	uns8 i,r,s;
           1205 			;	r=1;
02D9 3001  1206 	MOVLW 1
02DA 1283  1207 	BCF   0x03,RP0
02DB 1303  1208 	BCF   0x03,RP1
02DC 00A3  1209 	MOVWF r_3
           1210 			;	s=0;
02DD 01A4  1211 	CLRF  s
           1212 			;	for (i=0;i<8;i++)
02DE 01A2  1213 	CLRF  i_7
02DF 3008  1214 m030	MOVLW 8
02E0 1283  1215 	BCF   0x03,RP0
02E1 1303  1216 	BCF   0x03,RP1
02E2 0222  1217 	SUBWF i_7,W
02E3 1803  1218 	BTFSC 0x03,Carry
02E4 2B01  1219 	GOTO  m033
           1220 			;	switch(i)
02E5 0822  1221 	MOVF  i_7,W
02E6 1D03  1222 	BTFSS 0x03,Zero_
02E7 2AF4  1223 	GOTO  m031
           1224 			;		{
           1225 			;			case 0  : if (MAT[i]!=0x20) r=0; break;
02E8 302B  1226 	MOVLW 43
02E9 1283  1227 	BCF   0x03,RP0
02EA 1303  1228 	BCF   0x03,RP1
02EB 0722  1229 	ADDWF i_7,W
02EC 0084  1230 	MOVWF FSR
02ED 1383  1231 	BCF   0x03,IRP
02EE 0800  1232 	MOVF  INDF,W
02EF 3A20  1233 	XORLW 32
02F0 1903  1234 	BTFSC 0x03,Zero_
02F1 2AFD  1235 	GOTO  m032
02F2 01A3  1236 	CLRF  r_3
02F3 2AFD  1237 	GOTO  m032
           1238 			;			default : if (MAT[i]!=0x00) r=0;
02F4 302B  1239 m031	MOVLW 43
02F5 1283  1240 	BCF   0x03,RP0
02F6 1303  1241 	BCF   0x03,RP1
02F7 0722  1242 	ADDWF i_7,W
02F8 0084  1243 	MOVWF FSR
02F9 1383  1244 	BCF   0x03,IRP
02FA 0800  1245 	MOVF  INDF,W
02FB 1D03  1246 	BTFSS 0x03,Zero_
02FC 01A3  1247 	CLRF  r_3
           1248 			;		}
02FD 1283  1249 m032	BCF   0x03,RP0
02FE 1303  1250 	BCF   0x03,RP1
02FF 0AA2  1251 	INCF  i_7,1
0300 2ADF  1252 	GOTO  m030
           1253 			;
           1254 			;	if (r==1) s=2; // Sommaire appuyée
0301 1283  1255 m033	BCF   0x03,RP0
0302 1303  1256 	BCF   0x03,RP1
0303 0B23  1257 	DECFSZ r_3,W
0304 2B08  1258 	GOTO  m034
0305 3002  1259 	MOVLW 2
0306 00A4  1260 	MOVWF s
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 22

ADDR CODE  LINE SOURCE

           1261 			;	else
0307 2B36  1262 	GOTO  m039
           1263 			;	{
           1264 			;	r=1;
0308 3001  1265 m034	MOVLW 1
0309 1283  1266 	BCF   0x03,RP0
030A 1303  1267 	BCF   0x03,RP1
030B 00A3  1268 	MOVWF r_3
           1269 			;	for (i=0;i<8;i++)
030C 01A2  1270 	CLRF  i_7
030D 3008  1271 m035	MOVLW 8
030E 1283  1272 	BCF   0x03,RP0
030F 1303  1273 	BCF   0x03,RP1
0310 0222  1274 	SUBWF i_7,W
0311 1803  1275 	BTFSC 0x03,Carry
0312 2B30  1276 	GOTO  m038
           1277 			;	switch(i)
0313 0822  1278 	MOVF  i_7,W
0314 3A03  1279 	XORLW 3
0315 1D03  1280 	BTFSS 0x03,Zero_
0316 2B23  1281 	GOTO  m036
           1282 			;		{
           1283 			;			case 3  : if (MAT[i]!=0x20) r=0; break;
0317 302B  1284 	MOVLW 43
0318 1283  1285 	BCF   0x03,RP0
0319 1303  1286 	BCF   0x03,RP1
031A 0722  1287 	ADDWF i_7,W
031B 0084  1288 	MOVWF FSR
031C 1383  1289 	BCF   0x03,IRP
031D 0800  1290 	MOVF  INDF,W
031E 3A20  1291 	XORLW 32
031F 1903  1292 	BTFSC 0x03,Zero_
0320 2B2C  1293 	GOTO  m037
0321 01A3  1294 	CLRF  r_3
0322 2B2C  1295 	GOTO  m037
           1296 			;			default : if (MAT[i]!=0x00) r=0;
0323 302B  1297 m036	MOVLW 43
0324 1283  1298 	BCF   0x03,RP0
0325 1303  1299 	BCF   0x03,RP1
0326 0722  1300 	ADDWF i_7,W
0327 0084  1301 	MOVWF FSR
0328 1383  1302 	BCF   0x03,IRP
0329 0800  1303 	MOVF  INDF,W
032A 1D03  1304 	BTFSS 0x03,Zero_
032B 01A3  1305 	CLRF  r_3
           1306 			;		}
032C 1283  1307 m037	BCF   0x03,RP0
032D 1303  1308 	BCF   0x03,RP1
032E 0AA2  1309 	INCF  i_7,1
032F 2B0D  1310 	GOTO  m035
           1311 			;	if (r==1) s=1; // Guide appuyée
0330 1283  1312 m038	BCF   0x03,RP0
0331 1303  1313 	BCF   0x03,RP1
0332 0B23  1314 	DECFSZ r_3,W
0333 2B36  1315 	GOTO  m039
0334 3001  1316 	MOVLW 1
0335 00A4  1317 	MOVWF s
           1318 			;	}
           1319 			;
           1320 			;	return s;
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 23

ADDR CODE  LINE SOURCE

0336 1283  1321 m039	BCF   0x03,RP0
0337 1303  1322 	BCF   0x03,RP1
0338 0824  1323 	MOVF  s,W
0339 0008  1324 	RETURN
           1325 			;}
           1326 			;
           1327 			;
           1328 			;
           1329 			;
           1330 			;uns8 test_REP()	// teste si la touche Repetition est appuyée
           1331 			;{
           1332 test_REP
           1333 			;	uns8 i,r;
           1334 			;	r=1;
033A 3001  1335 	MOVLW 1
033B 1283  1336 	BCF   0x03,RP0
033C 1303  1337 	BCF   0x03,RP1
033D 00A3  1338 	MOVWF r_4
           1339 			;	for (i=0;i<8;i++)
033E 01A2  1340 	CLRF  i_8
033F 3008  1341 m040	MOVLW 8
0340 1283  1342 	BCF   0x03,RP0
0341 1303  1343 	BCF   0x03,RP1
0342 0222  1344 	SUBWF i_8,W
0343 1803  1345 	BTFSC 0x03,Carry
0344 2B62  1346 	GOTO  m043
           1347 			;	switch(i)
0345 0822  1348 	MOVF  i_8,W
0346 3A04  1349 	XORLW 4
0347 1D03  1350 	BTFSS 0x03,Zero_
0348 2B55  1351 	GOTO  m041
           1352 			;		{
           1353 			;			case 4  : if (MAT[i]!=0x08) r=0; break;
0349 302B  1354 	MOVLW 43
034A 1283  1355 	BCF   0x03,RP0
034B 1303  1356 	BCF   0x03,RP1
034C 0722  1357 	ADDWF i_8,W
034D 0084  1358 	MOVWF FSR
034E 1383  1359 	BCF   0x03,IRP
034F 0800  1360 	MOVF  INDF,W
0350 3A08  1361 	XORLW 8
0351 1903  1362 	BTFSC 0x03,Zero_
0352 2B5E  1363 	GOTO  m042
0353 01A3  1364 	CLRF  r_4
0354 2B5E  1365 	GOTO  m042
           1366 			;			default : if (MAT[i]!=0x00) r=0;
0355 302B  1367 m041	MOVLW 43
0356 1283  1368 	BCF   0x03,RP0
0357 1303  1369 	BCF   0x03,RP1
0358 0722  1370 	ADDWF i_8,W
0359 0084  1371 	MOVWF FSR
035A 1383  1372 	BCF   0x03,IRP
035B 0800  1373 	MOVF  INDF,W
035C 1D03  1374 	BTFSS 0x03,Zero_
035D 01A3  1375 	CLRF  r_4
           1376 			;		}
035E 1283  1377 m042	BCF   0x03,RP0
035F 1303  1378 	BCF   0x03,RP1
0360 0AA2  1379 	INCF  i_8,1
0361 2B3F  1380 	GOTO  m040
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 24

ADDR CODE  LINE SOURCE

           1381 			;	return r;
0362 1283  1382 m043	BCF   0x03,RP0
0363 1303  1383 	BCF   0x03,RP1
0364 0823  1384 	MOVF  r_4,W
0365 0008  1385 	RETURN
           1386 			;}
           1387 			;
           1388 			;
           1389 			;void tempo_1ms()
           1390 			;{
           1391 tempo_1ms
           1392 			;	TMR0=0;
0366 1283  1393 	BCF   0x03,RP0
0367 1303  1394 	BCF   0x03,RP1
0368 0181  1395 	CLRF  TMR0
           1396 			;	T0IF=0;
0369 110B  1397 	BCF   0x0B,T0IF
           1398 			;	while (T0IF!=1);
036A 1D0B  1399 m044	BTFSS 0x0B,T0IF
036B 2B6A  1400 	GOTO  m044
           1401 			;}
036C 0008  1402 	RETURN
           1403 			;
           1404 			;void tempo_10ms()
           1405 			;{
           1406 tempo_10ms
           1407 			; 	uns8 i;
           1408 			;	for (i=0; i<10;i++)
036D 1283  1409 	BCF   0x03,RP0
036E 1303  1410 	BCF   0x03,RP1
036F 01A2  1411 	CLRF  i_9
0370 300A  1412 m045	MOVLW 10
0371 1283  1413 	BCF   0x03,RP0
0372 1303  1414 	BCF   0x03,RP1
0373 0222  1415 	SUBWF i_9,W
0374 1803  1416 	BTFSC 0x03,Carry
0375 2B7B  1417 	GOTO  m046
           1418 			;				tempo_1ms();
0376 2366  1419 	CALL  tempo_1ms
0377 1283  1420 	BCF   0x03,RP0
0378 1303  1421 	BCF   0x03,RP1
0379 0AA2  1422 	INCF  i_9,1
037A 2B70  1423 	GOTO  m045
           1424 			;}
037B 0008  1425 m046	RETURN
           1426 			;
           1427 			;void tempo_50ms()
           1428 			;{
           1429 tempo_50ms
           1430 			; 	uns8 i;
           1431 			;	for (i=0; i<50;i++)
037C 1283  1432 	BCF   0x03,RP0
037D 1303  1433 	BCF   0x03,RP1
037E 01A6  1434 	CLRF  i_10
037F 3032  1435 m047	MOVLW 50
0380 1283  1436 	BCF   0x03,RP0
0381 1303  1437 	BCF   0x03,RP1
0382 0226  1438 	SUBWF i_10,W
0383 1803  1439 	BTFSC 0x03,Carry
0384 2B8A  1440 	GOTO  m048
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 25

ADDR CODE  LINE SOURCE

           1441 			;				tempo_1ms();
0385 2366  1442 	CALL  tempo_1ms
0386 1283  1443 	BCF   0x03,RP0
0387 1303  1444 	BCF   0x03,RP1
0388 0AA6  1445 	INCF  i_10,1
0389 2B7F  1446 	GOTO  m047
           1447 			;}
038A 0008  1448 m048	RETURN
           1449 			;
           1450 			;void tempo_100ms()
           1451 			;{
           1452 tempo_100ms
           1453 			;	uns8 i;
           1454 			;	for (i=0; i<100;i++)
038B 1283  1455 	BCF   0x03,RP0
038C 1303  1456 	BCF   0x03,RP1
038D 01A2  1457 	CLRF  i_11
038E 3064  1458 m049	MOVLW 100
038F 1283  1459 	BCF   0x03,RP0
0390 1303  1460 	BCF   0x03,RP1
0391 0222  1461 	SUBWF i_11,W
0392 1803  1462 	BTFSC 0x03,Carry
0393 2B99  1463 	GOTO  m050
           1464 			;				tempo_1ms();
0394 2366  1465 	CALL  tempo_1ms
0395 1283  1466 	BCF   0x03,RP0
0396 1303  1467 	BCF   0x03,RP1
0397 0AA2  1468 	INCF  i_11,1
0398 2B8E  1469 	GOTO  m049
           1470 			;}
0399 0008  1471 m050	RETURN
           1472 			;
           1473 			;
           1474 			;
           1475 			;void raz_KB()
           1476 			;{
           1477 raz_KB
           1478 			;	uns8 i;
           1479 			;	for (i=0;i<8;i++) KB[i]=0;	// vide le tableau
039A 1283  1480 	BCF   0x03,RP0
039B 1303  1481 	BCF   0x03,RP1
039C 01AA  1482 	CLRF  i_12
039D 3008  1483 m051	MOVLW 8
039E 1283  1484 	BCF   0x03,RP0
039F 1303  1485 	BCF   0x03,RP1
03A0 022A  1486 	SUBWF i_12,W
03A1 1803  1487 	BTFSC 0x03,Carry
03A2 2BAA  1488 	GOTO  m052
03A3 303B  1489 	MOVLW 59
03A4 072A  1490 	ADDWF i_12,W
03A5 0084  1491 	MOVWF FSR
03A6 1383  1492 	BCF   0x03,IRP
03A7 0180  1493 	CLRF  INDF
03A8 0AAA  1494 	INCF  i_12,1
03A9 2B9D  1495 	GOTO  m051
           1496 			;}
03AA 0008  1497 m052	RETURN
           1498 			;
           1499 			;
           1500 			;//traduit les touches Minitel vers ZX
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 26

ADDR CODE  LINE SOURCE

           1501 			;// KB[x] contient les touches actives
           1502 			;
           1503 			;void conversion()
           1504 			;{
           1505 conversion
           1506 			;	uns8 k,b;
           1507 			;	uns8 i,j,a,n;
           1508 			;	uns16 ad;
           1509 			;	
           1510 			;	raz_KB();
03AB 239A  1511 	CALL  raz_KB
           1512 			;	
           1513 			;
           1514 			;	for (i=0;i<8;i++)
03AC 1283  1515 	BCF   0x03,RP0
03AD 1303  1516 	BCF   0x03,RP1
03AE 01A4  1517 	CLRF  i_13
03AF 3008  1518 m053	MOVLW 8
03B0 1283  1519 	BCF   0x03,RP0
03B1 1303  1520 	BCF   0x03,RP1
03B2 0224  1521 	SUBWF i_13,W
03B3 1803  1522 	BTFSC 0x03,Carry
03B4 2C46  1523 	GOTO  m067
           1524 			;	{	
           1525 			;	ad=0;
03B5 01A8  1526 	CLRF  ad
03B6 01A9  1527 	CLRF  ad+1
           1528 			;	k=MAT[i];
03B7 302B  1529 	MOVLW 43
03B8 0724  1530 	ADDWF i_13,W
03B9 0084  1531 	MOVWF FSR
03BA 1383  1532 	BCF   0x03,IRP
03BB 0800  1533 	MOVF  INDF,W
03BC 00A2  1534 	MOVWF k
           1535 			;	for (b=0;b<8;b++)
03BD 01A3  1536 	CLRF  b_2
03BE 3008  1537 m054	MOVLW 8
03BF 1283  1538 	BCF   0x03,RP0
03C0 1303  1539 	BCF   0x03,RP1
03C1 0223  1540 	SUBWF b_2,W
03C2 1803  1541 	BTFSC 0x03,Carry
03C3 2C42  1542 	GOTO  m066
           1543 			;			{
           1544 			;				if (k.7!=0) 
03C4 1FA2  1545 	BTFSS k,7
03C5 2C38  1546 	GOTO  m065
           1547 			;					for (j=0;j<8;j++)
03C6 01A5  1548 	CLRF  j_2
03C7 3008  1549 m055	MOVLW 8
03C8 1283  1550 	BCF   0x03,RP0
03C9 1303  1551 	BCF   0x03,RP1
03CA 0225  1552 	SUBWF j_2,W
03CB 1803  1553 	BTFSC 0x03,Carry
03CC 2C38  1554 	GOTO  m065
           1555 			;						{
           1556 			;							n=ad+j;
03CD 0825  1557 	MOVF  j_2,W
03CE 0728  1558 	ADDWF ad,W
03CF 00A7  1559 	MOVWF n_3
           1560 			;							a=0;
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 27

ADDR CODE  LINE SOURCE

03D0 01A6  1561 	CLRF  a_4
           1562 			;							switch (i)
03D1 0824  1563 	MOVF  i_13,W
03D2 1903  1564 	BTFSC 0x03,Zero_
03D3 2BEA  1565 	GOTO  m056
03D4 3A01  1566 	XORLW 1
03D5 1903  1567 	BTFSC 0x03,Zero_
03D6 2BF2  1568 	GOTO  m057
03D7 3A03  1569 	XORLW 3
03D8 1903  1570 	BTFSC 0x03,Zero_
03D9 2BFA  1571 	GOTO  m058
03DA 3A01  1572 	XORLW 1
03DB 1903  1573 	BTFSC 0x03,Zero_
03DC 2C03  1574 	GOTO  m059
03DD 3A07  1575 	XORLW 7
03DE 1903  1576 	BTFSC 0x03,Zero_
03DF 2C0C  1577 	GOTO  m060
03E0 3A01  1578 	XORLW 1
03E1 1903  1579 	BTFSC 0x03,Zero_
03E2 2C15  1580 	GOTO  m061
03E3 3A03  1581 	XORLW 3
03E4 1903  1582 	BTFSC 0x03,Zero_
03E5 2C1D  1583 	GOTO  m062
03E6 3A01  1584 	XORLW 1
03E7 1903  1585 	BTFSC 0x03,Zero_
03E8 2C26  1586 	GOTO  m063
03E9 2C2E  1587 	GOTO  m064
           1588 			;								{
           1589 			;									case 0 : a=decod0[n]; break;	
03EA 1283  1590 m056	BCF   0x03,RP0
03EB 1303  1591 	BCF   0x03,RP1
03EC 0827  1592 	MOVF  n_3,W
03ED 2001  1593 	CALL  _const1
03EE 1283  1594 	BCF   0x03,RP0
03EF 1303  1595 	BCF   0x03,RP1
03F0 00A6  1596 	MOVWF a_4
03F1 2C2E  1597 	GOTO  m064
           1598 			;									case 1 : a=decod1[n]; break;	
03F2 1283  1599 m057	BCF   0x03,RP0
03F3 1303  1600 	BCF   0x03,RP1
03F4 0827  1601 	MOVF  n_3,W
03F5 207E  1602 	CALL  _const3
03F6 1283  1603 	BCF   0x03,RP0
03F7 1303  1604 	BCF   0x03,RP1
03F8 00A6  1605 	MOVWF a_4
03F9 2C2E  1606 	GOTO  m064
           1607 			;									case 2 : a=decod2[n]; break;	
03FA 3040  1608 m058	MOVLW 64
03FB 1283  1609 	BCF   0x03,RP0
03FC 1303  1610 	BCF   0x03,RP1
03FD 0727  1611 	ADDWF n_3,W
03FE 207E  1612 	CALL  _const3
03FF 1283  1613 	BCF   0x03,RP0
0400 1303  1614 	BCF   0x03,RP1
0401 00A6  1615 	MOVWF a_4
0402 2C2E  1616 	GOTO  m064
           1617 			;									case 3 : a=decod3[n]; break;	
0403 3080  1618 m059	MOVLW 128
0404 1283  1619 	BCF   0x03,RP0
0405 1303  1620 	BCF   0x03,RP1
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 28

ADDR CODE  LINE SOURCE

0406 0727  1621 	ADDWF n_3,W
0407 207E  1622 	CALL  _const3
0408 1283  1623 	BCF   0x03,RP0
0409 1303  1624 	BCF   0x03,RP1
040A 00A6  1625 	MOVWF a_4
040B 2C2E  1626 	GOTO  m064
           1627 			;									case 4 : a=decod4[n]; break;	
040C 30C0  1628 m060	MOVLW 192
040D 1283  1629 	BCF   0x03,RP0
040E 1303  1630 	BCF   0x03,RP1
040F 0727  1631 	ADDWF n_3,W
0410 207E  1632 	CALL  _const3
0411 1283  1633 	BCF   0x03,RP0
0412 1303  1634 	BCF   0x03,RP1
0413 00A6  1635 	MOVWF a_4
0414 2C2E  1636 	GOTO  m064
           1637 			;									case 5 : a=decod5[n]; break;	
0415 1283  1638 m061	BCF   0x03,RP0
0416 1303  1639 	BCF   0x03,RP1
0417 0827  1640 	MOVF  n_3,W
0418 211F  1641 	CALL  _const7
0419 1283  1642 	BCF   0x03,RP0
041A 1303  1643 	BCF   0x03,RP1
041B 00A6  1644 	MOVWF a_4
041C 2C2E  1645 	GOTO  m064
           1646 			;									case 6 : a=decod6[n]; break;	
041D 3040  1647 m062	MOVLW 64
041E 1283  1648 	BCF   0x03,RP0
041F 1303  1649 	BCF   0x03,RP1
0420 0727  1650 	ADDWF n_3,W
0421 211F  1651 	CALL  _const7
0422 1283  1652 	BCF   0x03,RP0
0423 1303  1653 	BCF   0x03,RP1
0424 00A6  1654 	MOVWF a_4
0425 2C2E  1655 	GOTO  m064
           1656 			;									case 7 : a=decod7[n]; break;	
0426 3040  1657 m063	MOVLW 64
0427 1283  1658 	BCF   0x03,RP0
0428 1303  1659 	BCF   0x03,RP1
0429 0727  1660 	ADDWF n_3,W
042A 2001  1661 	CALL  _const1
042B 1283  1662 	BCF   0x03,RP0
042C 1303  1663 	BCF   0x03,RP1
042D 00A6  1664 	MOVWF a_4
           1665 			;								}
           1666 			;
           1667 			;							KB[j]=KB[j] | a;
042E 303B  1668 m064	MOVLW 59
042F 1283  1669 	BCF   0x03,RP0
0430 1303  1670 	BCF   0x03,RP1
0431 0725  1671 	ADDWF j_2,W
0432 0084  1672 	MOVWF FSR
0433 1383  1673 	BCF   0x03,IRP
0434 0826  1674 	MOVF  a_4,W
0435 0480  1675 	IORWF INDF,1
           1676 			;						}
0436 0AA5  1677 	INCF  j_2,1
0437 2BC7  1678 	GOTO  m055
           1679 			;				k=k*2;
0438 1003  1680 m065	BCF   0x03,Carry
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 29

ADDR CODE  LINE SOURCE

0439 1283  1681 	BCF   0x03,RP0
043A 1303  1682 	BCF   0x03,RP1
043B 0DA2  1683 	RLF   k,1
           1684 			;				ad=ad+8;
043C 3008  1685 	MOVLW 8
043D 07A8  1686 	ADDWF ad,1
043E 1803  1687 	BTFSC 0x03,Carry
043F 0AA9  1688 	INCF  ad+1,1
           1689 			;			}
0440 0AA3  1690 	INCF  b_2,1
0441 2BBE  1691 	GOTO  m054
           1692 			;	}
0442 1283  1693 m066	BCF   0x03,RP0
0443 1303  1694 	BCF   0x03,RP1
0444 0AA4  1695 	INCF  i_13,1
0445 2BAF  1696 	GOTO  m053
           1697 			;
           1698 			;}
0446 0008  1699 m067	RETURN
           1700 			;
           1701 			;
           1702 			;
           1703 			;// envoi les données du tableau KB vers les registres du CPLD
           1704 			;void trf()
           1705 			;{
           1706 trf
           1707 			;	uns8 n,d,b;
           1708 			;	for (n=8;n>0;n--)
0447 3008  1709 	MOVLW 8
0448 1283  1710 	BCF   0x03,RP0
0449 1303  1711 	BCF   0x03,RP1
044A 00A6  1712 	MOVWF n_4
044B 1283  1713 m068	BCF   0x03,RP0
044C 1303  1714 	BCF   0x03,RP1
044D 08A6  1715 	MOVF  n_4,1
044E 1903  1716 	BTFSC 0x03,Zero_
044F 2C6D  1717 	GOTO  m071
           1718 			;		{
           1719 			;			d=KB[n-1];
0450 303A  1720 	MOVLW 58
0451 0726  1721 	ADDWF n_4,W
0452 0084  1722 	MOVWF FSR
0453 1383  1723 	BCF   0x03,IRP
0454 0800  1724 	MOVF  INDF,W
0455 00A7  1725 	MOVWF d
           1726 			;		//	d=MAT[n];
           1727 			;			for (b=0;b<5;b++)
0456 01A8  1728 	CLRF  b_3
0457 3005  1729 m069	MOVLW 5
0458 1283  1730 	BCF   0x03,RP0
0459 1303  1731 	BCF   0x03,RP1
045A 0228  1732 	SUBWF b_3,W
045B 1803  1733 	BTFSC 0x03,Carry
045C 2C67  1734 	GOTO  m070
           1735 			;				{
           1736 			;					KB_DATA=d.4;
045D 1E27  1737 	BTFSS d,4
045E 1087  1738 	BCF   0x07,KB_DATA
045F 1A27  1739 	BTFSC d,4
0460 1487  1740 	BSF   0x07,KB_DATA
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 30

ADDR CODE  LINE SOURCE

           1741 			;					KB_CLK=1;
0461 1507  1742 	BSF   0x07,KB_CLK
           1743 			;					d=d*2;
0462 1003  1744 	BCF   0x03,Carry
0463 0DA7  1745 	RLF   d,1
           1746 			;					KB_CLK=0;
0464 1107  1747 	BCF   0x07,KB_CLK
           1748 			;				}
0465 0AA8  1749 	INCF  b_3,1
0466 2C57  1750 	GOTO  m069
           1751 			;			nop();
0467 0000  1752 m070	NOP  
           1753 			;			nop();	
0468 0000  1754 	NOP  
           1755 			;		}
0469 1283  1756 	BCF   0x03,RP0
046A 1303  1757 	BCF   0x03,RP1
046B 03A6  1758 	DECF  n_4,1
046C 2C4B  1759 	GOTO  m068
           1760 			;	KB_LATCH=1;
046D 1283  1761 m071	BCF   0x03,RP0
046E 1303  1762 	BCF   0x03,RP1
046F 1407  1763 	BSF   0x07,KB_LATCH
           1764 			;	nop();
0470 0000  1765 	NOP  
           1766 			;	nop();
0471 0000  1767 	NOP  
           1768 			;	KB_LATCH=0;
0472 1007  1769 	BCF   0x07,KB_LATCH
0473 0008  1770 	RETURN
           1771 
           1772 	END
           1773 
           1774 
           1775 ; *** KEY INFO ***
           1776 
           1777 ; 0x0275 P0   22 word(s)  1 % : scan
           1778 ; 0x02AD P0   44 word(s)  2 % : test_RESET
           1779 ; 0x02D9 P0   97 word(s)  4 % : test_VOLUME
           1780 ; 0x0366 P0    7 word(s)  0 % : tempo_1ms
           1781 ; 0x036D P0   15 word(s)  0 % : tempo_10ms
           1782 ; 0x037C P0   15 word(s)  0 % : tempo_50ms
           1783 ; 0x038B P0   15 word(s)  0 % : tempo_100ms
           1784 ; 0x03AB P0  156 word(s)  7 % : conversion
           1785 ; 0x0447 P0   45 word(s)  2 % : trf
           1786 ; 0x039A P0   17 word(s)  0 % : raz_KB
           1787 ; 0x0230 P0   24 word(s)  1 % : copy_MAT
           1788 ; 0x0248 P0   45 word(s)  2 % : compare_MAT
           1789 ; 0x028B P0   26 word(s)  1 % : noKey
           1790 ; 0x02A5 P0    8 word(s)  0 % : waitnoKey
           1791 ; 0x033A P0   44 word(s)  2 % : test_REP
           1792 ; 0x0202 P0   46 word(s)  2 % : send_REP
           1793 ; 0x0180 P0  130 word(s)  6 % : main
           1794 ; 0x0001 P0  125 word(s)  6 % : _const1
           1795 ; 0x007E P0  161 word(s)  7 % : _const3
           1796 ; 0x011F P0   97 word(s)  4 % : _const7
           1797 
           1798 ; RAM usage: 36 bytes (11 local), 332 bytes free
           1799 ; Maximum call level: 3
           1800 ;  Codepage 0 has 1140 word(s) :  55 %
CC5X Version 3.4I,   File: keyboard.c           9. Apr 2022  18:53   Page 31

ADDR CODE  LINE SOURCE

           1801 ;  Codepage 1 has    0 word(s) :   0 %
           1802 ;  Codepage 2 has    0 word(s) :   0 %
           1803 ;  Codepage 3 has    0 word(s) :   0 %
           1804 ; Total of 1140 code words (13 %)
